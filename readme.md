## Визуализатор зависимостей пакетов Alpine Linux

### 1. Общее описание
**Dependency Visualizer** — это инструмент для визуализации зависимостей пакетов Alpine Linux на основе файла APKINDEX. Программа загружает файл APKINDEX.tar.gz из указанного репозитория, распаковывает его, строит граф зависимостей заданного пакета и визуализирует его с помощью диаграмм Mermaid.

### 2. Описание всех функций и настроек

Основные функции:

**download_and_extract_apkindex(repo_url):**

    Описание: 
    Загружает файл APKINDEX.tar.gz из указанного репозитория и распаковывает APKINDEX.

    Параметры:
    repo_url (str): URL-адрес репозитория Alpine Linux.

**parse_apkindex_content(content):**

    Описание: 
    Парсит содержимое файла APKINDEX и возвращает словарь с информацией о пакетах.

    Параметры:
    content (str): Содержимое файла APKINDEX.

    *Возвращает: packages (dict): Словарь с информацией о пакетах.*

**build_dependency_graph(packages, pkg_name, graph, visited, depth=0, max_depth=10):**

    Описание: 
    Рекурсивно строит граф зависимостей для заданного пакета.

    Параметры:
    packages (dict): Словарь с информацией о пакетах.
    pkg_name (str): Имя пакета, для которого строится граф.
    graph (list): Список ребер графа.
    visited (set): Множество посещенных пакетов.
    depth (int): Текущая глубина рекурсии.
    max_depth (int): Максимальная глубина рекурсии (по умолчанию 10).

**sanitize_node_id(name):**

    Описание: 
    Преобразует имя узла в допустимый идентификатор для Mermaid, заменяя недопустимые символы.

    Параметры:
    name (str): Исходное имя узла.

    Возвращает:
    sanitized_name (str): Санитизированное имя узла.

**generate_mermaid_graph(graph):**

    Описание:
    Генерирует код диаграммы Mermaid на основе графа зависимостей.

    Параметры:
    graph (list): Список ребер графа.

    Возвращает:
    mermaid (str): Код диаграммы Mermaid.

**visualize_graph(mermaid_code, renderer_path):**

    Описание:
    Визуализирует граф зависимостей, создавая изображение на основе кода Mermaid.

    Параметры:
    mermaid_code (str): Код диаграммы Mermaid.
    renderer_path (str): Путь к программе рендеринга (например, mmdc).

### Настройки:
    --renderer: Путь к программе рендеринга Mermaid (например, mmdc).
    --package: Имя пакета, для которого необходимо построить граф зависимостей.
    --repository: URL-адрес репозитория пакетов Alpine Linux.
    max_depth: Максимальная глубина рекурсии при построении графа (по умолчанию 10). Можно изменить в коде функции build_dependency_graph.

### 3. Описание команд для сборки проекта

**Требования:**
    Python 3.x
    Node.js (для установки Mermaid CLI)
    Mermaid CLI (mmdc)
    Библиотека requests
    Библиотека tarfile (входит в стандартную библиотеку Python)
    pytest (для запуска тестов)

#### Установка зависимостей:

**Установите Node.js:**

    Установка nvm:
    ```
    curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.4/install.sh | bash
    ```
    Загрузите конфигурацию nvm:
    ```
    source ~/.bashrc  # или source ~/.zshrc, если используете zsh
    ```
    Установите последнюю LTS версию Node.js:
    ```
    nvm install --lts
    nvm use --lts
    ```

**Установите Mermaid CLI:**

    ```
    npm install -g @mermaid-js/mermaid-cli
    ```

**Установите библиотеку requests:**

    ```
    pip install requests
    ```

**Установите pytest для запуска тестов:**

    ```
    pip install pytest
    ```

**Сборка проекта:**

    1. Клонируйте репозиторий или скопируйте файлы dependency_visualizer.py, APKINDEX, и test_dependency_visualizer.py в рабочую директорию.
    2. Запустите тесты, чтобы убедиться в корректной работе:
        ```
        pytest test_dependency_visualizer.py
        ```

### 4. Примеры использования

    1. Построение графа зависимостей для конкретного пакета

    Команда:
    ```
    python dependency_visualizer.py --renderer mmdc --package openldap --repository https://dl-cdn.alpinelinux.org/alpine/v3.0/main/x86
    ```

    Результат:
    - Программа загрузит файл APKINDEX.tar.gz из указанного репозитория.
    - Распакует APKINDEX.
    - Построит граф зависимостей для пакета openldap.
    - Сгенерирует файл graph.png с визуализацией графа.

    2. Просмотр графа зависимостей
    Откройте файл graph.png с помощью любого просмотра изображений.

    Пример графа:

    (Примечание: Здесь должен быть приложен скриншот с примером графа.)

### 5. Результаты прогона тестов

    Запуск тестов:

    ```
    pytest test_dependency_visualizer.py
    ```

    Вывод:

    ```
    ================================ test session starts =================================
    platform darwin -- Python 3.11.5, pytest-7.4.0, pluggy-1.0.0
    rootdir: /Users/andrey/Documents/Config-2
    plugins: anyio-3.5.0
    collected 2 items                                                                    

    test_dependency_visualizer.py ..                                               [100%]

    ================================= 2 passed in 0.16s ==================================
    ```

    Все тесты успешно проходят, что подтверждает корректную работу основных функций программы.

### Дополнительная информация

**Структура репозитория Alpine Linux**

    Репозитории Alpine Linux содержат файлы APKINDEX.tar.gz, которые включают в себя файл APKINDEX с информацией о пакетах.

    Пример URL-адреса репозитория:
    ```
    https://dl-cdn.alpinelinux.org/alpine/v3.0/main/x86
    ```

**Ограничение глубины графа**
    Параметр max_depth в функции build_dependency_graph ограничивает глубину рекурсии для предотвращения слишком больших графов.

    По умолчанию max_depth установлен в 10. Вы можете изменить это значение в зависимости от ваших потребностей.

**Санитизация имён узлов**
    Функция sanitize_node_id(name) заменяет недопустимые символы в именах узлов на подчёркивания, что позволяет избежать ошибок при парсинге диаграммы Mermaid.

    Оригинальные имена узлов сохраняются в виде меток, поэтому информация не теряется.

### Заключение
Данная программа позволяет визуализировать зависимости пакетов Alpine Linux из указанного репозитория, что может быть полезно для анализа и понимания структуры зависимостей в системе.

Ссылка на git-репозиторий: <https://github.com/e-and-a/Config-2>





